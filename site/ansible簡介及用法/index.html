<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Ansibleç°¡ä»‹åŠç”¨æ³• - Darren</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Ansible\u7c21\u4ecb\u53ca\u7528\u6cd5";
        var mkdocs_page_input_path = "ansible\u7c21\u4ecb\u53ca\u7528\u6cd5.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../image/favicon.ico" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../note/">ä½¿ç”¨ MkDocs å»ºç«‹æ–‡ä»¶ç¶²ç«™æ•™å­¸ç­†è¨˜</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../%E5%AE%B9%E5%99%A8%E7%9F%A5%E8%AD%98/">Linux å®¹å™¨ç­†è¨˜</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../docker_commands/">Dockerå¸¸ç”¨å‘½ä»¤</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Ansibleç°¡ä»‹åŠç”¨æ³•</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#ansible_1">ä»€éº¼æ˜¯ Ansible</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#idempotency">ğŸ“Œ ä»€éº¼æ˜¯å†ªç­‰æ€§ (Idempotency)</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_1">åè©èˆ‡ç”Ÿæ´»æ¯”å–»</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#inventory-playbook">Inventory èˆ‡ Playbook é—œä¿‚</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ansible_2">å¦‚ä½•ä½¿ç”¨ Ansible</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role">å»ºç«‹ Role</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../%E9%81%8B%E7%B6%AD%E7%9F%A5%E8%AD%98/">é‹ç¶­çŸ¥è­˜</a>
                </li>
              </ul>
              <ul>
<<<<<<< HEAD
<<<<<<< HEAD
                <li class="toctree-l1"><a class="reference internal" href="../operator%E4%BB%8B%E7%B4%B9/">operatorä»‹ç´¹</a>
=======
                <li class="toctree-l1"><a class="reference internal" href="../ocp%E5%91%BD%E4%BB%A4/">ocpå‘½ä»¤</a>
>>>>>>> 36748704b7cc296b7620e8095c1eab305c4f4bcd
=======
                <li class="toctree-l1"><a class="reference internal" href="../ocp%E5%91%BD%E4%BB%A4/">ocpå‘½ä»¤</a>
>>>>>>> 36748704b7cc296b7620e8095c1eab305c4f4bcd
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Darren</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Ansibleç°¡ä»‹åŠç”¨æ³•</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="ansible">Ansible å­¸ç¿’ç­†è¨˜</h1>
<h2 id="ansible_1">ä»€éº¼æ˜¯ Ansible</h2>
<p>Ansible æ˜¯ä¸€å€‹åŸºæ–¼ Python çš„è‡ªå‹•åŒ–å·¥å…·ï¼Œç”¨ä¾†ç®¡ç†ä¼ºæœå™¨é…ç½®ã€éƒ¨ç½²æ‡‰ç”¨ç¨‹å¼åŠè‡ªå‹•åŒ– IT ä»»å‹™ã€‚å®ƒæ¡ç”¨ <strong>ç„¡ä»£ç†ï¼ˆagentlessï¼‰æ¶æ§‹</strong>ï¼Œé€é <strong>SSH é€£ç·š</strong> ç®¡ç†ç›®æ¨™ä¸»æ©Ÿï¼Œä½¿ç”¨ç°¡å–®æ˜“è®€çš„ YAML èªæ³•æ’°å¯« Playbookã€‚</p>
<h2 id="idempotency">ğŸ“Œ ä»€éº¼æ˜¯å†ªç­‰æ€§ (Idempotency)</h2>
<p>åœ¨ è‡ªå‹•åŒ–é…ç½®ç®¡ç† è£¡ï¼Œ<strong>å†ªç­‰æ€§æŒ‡çš„æ˜¯ åŒä¸€å€‹æ“ä½œä¸ç®¡åŸ·è¡Œå¤šå°‘æ¬¡ï¼Œæœ€çµ‚çµæœéƒ½æœƒæ˜¯ä¸€æ¨£çš„</strong>ã€‚</p>
<p>æ›å¥è©±èªªï¼š</p>
<p>ç¬¬ä¸€æ¬¡åŸ·è¡Œï¼š<strong>æœƒåšå‡ºéœ€è¦çš„æ”¹è®Š</strong>ï¼ˆä¾‹å¦‚å®‰è£å¥—ä»¶ã€ä¿®æ”¹æª”æ¡ˆï¼‰ã€‚</p>
<p>ç¬¬äºŒæ¬¡ã€ç¬¬ä¸‰æ¬¡å†åŸ·è¡Œï¼šå¦‚æœç³»çµ±å·²ç¶“ç¬¦åˆéœ€æ±‚ï¼Œå°±ä¸æœƒ<strong>å†é‡è¤‡æ”¹è®Š</strong>ã€‚ </p>
<p>èˆ‰ä¾‹ï¼š</p>
<pre><code class="language-yaml">- name: å®‰è£ httpd
  yum:
    name: httpd
    state: present
</code></pre>
<p>å¦‚æœç³»çµ± <strong>é‚„æ²’è£ httpd â†’ Ansible å¹«ä½ å®‰è£ã€‚</strong></p>
<p>å¦‚æœç³»çµ± <strong>å·²ç¶“æœ‰ httpd â†’ ä¸æœƒé‡è¤‡å®‰è£ã€‚</strong></p>
<p>é€™å°±æ˜¯<strong>å†ªç­‰æ€§ï¼Œé¿å…ã€Œç„¡è¬‚çš„å‹•ä½œã€</strong>ã€‚</p>
<h3 id="_1">åè©èˆ‡ç”Ÿæ´»æ¯”å–»</h3>
<table>
<thead>
<tr>
<th>åè©</th>
<th>ç”Ÿæ´»æ¯”å–»</th>
</tr>
</thead>
<tbody>
<tr>
<td>Task</td>
<td>åšä¸€ä»¶äº‹ â†’ æ¯”å¦‚ç…®ä¸€æ¯å’–å•¡</td>
</tr>
<tr>
<td>Play</td>
<td>ä¸€çµ„äººåšä¸€çµ„ä»»å‹™ â†’ æ¯”å¦‚ã€Œåª½åª½ç…®å’–å•¡ã€å¼Ÿå¼Ÿæ‹¿é¤…ä¹¾ã€</td>
</tr>
<tr>
<td>Playbook</td>
<td>æ•´æœ¬æ´»å‹•æ‰‹å†Š â†’ ã€Œæ—©æ™¨èšæœƒæµç¨‹ï¼Œå¾ç…®å’–å•¡åˆ°æ“ºæ¡Œå­ã€</td>
</tr>
<tr>
<td>Variable</td>
<td>å¯æ›¿æ›çš„è³‡è¨Š â†’ ã€Œå’–å•¡å£å‘³ã€å¯ä»¥è®ŠåŒ–</td>
</tr>
<tr>
<td>Role</td>
<td>æ¨¡çµ„åŒ–å–®å…ƒ â†’ ã€Œç…®å’–å•¡çš„æµç¨‹ã€å¯ä»¥é‡è¤‡ç”¨åœ¨ä¸åŒå ´åˆ</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="inventory-playbook">Inventory èˆ‡ Playbook é—œä¿‚</h2>
<ul>
<li><strong>Inventory</strong>ï¼šä¸»æ©Ÿæ¸…å–®</li>
</ul>
<pre><code class="language-ini">[helloworld] # ç¾¤çµ„åç¨±
localhost ansible_connection=local # ä¸»æ©Ÿåç¨± + é€£ç·šæ–¹å¼
</code></pre>
<p><img alt="inventoryä¸»æ©Ÿ.png" src="../image/ansible/inventory%E4%B8%BB%E6%A9%9F.png" title="inventoryä¸»æ©Ÿ.png" /></p>
<ul>
<li><strong>Playbook</strong>ï¼šå‘Šè¨´ Ansible"è¦å°å“ªäº›ä¸»æ©Ÿåšä»€éº¼äº‹"</li>
</ul>
<pre><code class="language-yaml">- name: åŸ·è¡ŒHello worldåˆ—å°çš„ansible  # Play åç¨±
  hosts: helloworld            # æ“ä½œçš„ä¸»æ©Ÿç¾¤çµ„
  gather_facts: no             # ä¸æ”¶é›†ç³»çµ±è³‡è¨Š

  tasks:
    - name: é€™æ˜¯ç¬¬ä¸€å€‹taskä»»å‹™  # Task åç¨±
      debug:
        msg: &quot;Hello world&quot;          # Module debug é¡¯ç¤ºè¨Šæ¯
</code></pre>
<p><img alt="playbookå…§å®¹èˆ‡å¯¦éš›åŸ·è¡Œ.png" src="../image/ansible/playbook%E5%85%A7%E5%AE%B9%E8%88%87%E5%AF%A6%E9%9A%9B%E5%9F%B7%E8%A1%8C.png" title="playbookå…§å®¹èˆ‡å¯¦éš›åŸ·è¡Œ.png" /></p>
<blockquote>
<p>æ³¨æ„ï¼š
- Playbook åç¨±å¯è‡ªè¨‚ï¼Œä½†åŸ·è¡Œæ™‚è¦æŒ‡å®šæ­£ç¢ºè·¯å¾‘
- å¦‚æœ <code>hosts:</code> æŒ‡å‘ä¸å­˜åœ¨çš„ç¾¤çµ„ï¼Œæœƒå‡ºç¾ <code>skipping: no hosts matched</code></p>
</blockquote>
<hr />
<h2 id="ansible_2">å¦‚ä½•ä½¿ç”¨ Ansible</h2>
<ol>
<li><strong>å»ºç«‹ Ansible é…ç½®æª”æ¡ˆ</strong> <code>ansible.cfg</code>ï¼ˆé€™æ˜¯ç‚ºäº†å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>ansible-playbook {playbook}</code>ï¼‰</li>
</ol>
<pre><code class="language-ini">[defaults]
inventory = ./inventory.ini
</code></pre>
<ol>
<li><strong>å»ºç«‹ Inventory æ¸…å–®</strong> <code>inventory.ini</code></li>
</ol>
<pre><code class="language-ini">[helloworld]
localhost ansible_connection=local
</code></pre>
<ol>
<li><strong>åŸ·è¡Œ Playbook</strong></li>
</ol>
<pre><code class="language-bash"># æŒ‡å®š Inventory
ansible-playbook -i inventory.ini playbook.yml

# ä½¿ç”¨ ansible.cfg çš„é è¨­ inventory
ansible-playbook playbook.yml
</code></pre>
<hr />
<h2 id="role">å»ºç«‹ Role</h2>
<h1 id="ansible-role">Ansible Role ä»‹ç´¹</h1>
<p>åœ¨ Ansible è£¡ï¼Œ<strong>Role</strong> æ˜¯ä¸€å€‹ã€Œæ¨¡çµ„åŒ–ã€å¯é‡è¤‡ä½¿ç”¨çš„ä»»å‹™å–®å…ƒã€ï¼Œå®ƒæŠŠç›¸é—œçš„ä»»å‹™ã€è®Šæ•¸ã€æ¨¡æ¿ã€éœæ…‹æª”æ¡ˆã€Handler ç­‰éƒ½æ•´ç†åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿ä½ åœ¨ä¸åŒ Playbook æˆ–å°ˆæ¡ˆä¸­é‡è¤‡ä½¿ç”¨ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½é‡å¯«æ•´å€‹æµç¨‹ã€‚</p>
<p>ç°¡å–®èªªï¼Œ<strong>Role å°±åƒä¸€å€‹å°å‹ç¨‹å¼åº«æˆ–åŠŸèƒ½æ¨¡çµ„</strong>ã€‚</p>
<pre><code class="language-bash">ansible-galaxy init roles/æª”å
</code></pre>
<p><img alt="å¦‚ä½•å‰µå»ºgalaxy.png" src="../image/ansible/%E5%A6%82%E4%BD%95%E5%89%B5%E5%BB%BAgalaxy.png" title="å¦‚ä½•å‰µå»ºgalaxy.png" /></p>
<p>ç”Ÿæˆçš„ Role çµæ§‹å¦‚ä¸‹ï¼š</p>
<pre><code>roles/
â””â”€â”€ æª”å/
â”œâ”€â”€ README.md # Role èªªæ˜æ–‡ä»¶
â”œâ”€â”€ defaults/
â”‚ â””â”€â”€ main.yml # é è¨­è®Šæ•¸ï¼ˆä½å„ªå…ˆç´šï¼‰
â”œâ”€â”€ files/ # éœæ…‹æª”æ¡ˆï¼Œä¾‹å¦‚è¨­å®šæª”ã€å®‰è£åŒ…
â”œâ”€â”€ handlers/
â”‚ â””â”€â”€ main.yml # é€šçŸ¥ Handlerï¼Œä¾‹å¦‚é‡å•Ÿæœå‹™
â”œâ”€â”€ meta/
â”‚ â””â”€â”€ main.yml # Role å…ƒè³‡æ–™ï¼Œä¾‹å¦‚ä¾è³´å…¶ä»– Role
â”œâ”€â”€ tasks/
â”‚ â””â”€â”€ main.yml # ä¸»è¦ä»»å‹™æµç¨‹
â”œâ”€â”€ templates/ # Jinja2 æ¨¡æ¿æª”æ¡ˆ
â””â”€â”€ vars/
â””â”€â”€ main.yml # é«˜å„ªå…ˆç´šè®Šæ•¸
</code></pre>
<h1 id="ansible_3">Ansible å¯¦å‹™éŒ¯èª¤ï¼šç›®éŒ„å‘½åéŒ¯èª¤</h1>
<h2 id="_2">éŒ¯èª¤ç¾è±¡</h2>
<p>åŸ·è¡Œ <code>ansible-playbook</code> æ™‚å‡ºç¾ä»¥ä¸‹éŒ¯èª¤ï¼š</p>
<pre><code class="language-bash">ERROR! the role 'hello' was not found in /path/to/roles/...
</code></pre>
<p><a href="../image/ansible/roles%E7%9B%AE%E9%8C%84.png"><img alt="rolesç›®éŒ„å‘½åéŒ¯èª¤" src="../image/ansible/roles%E7%9B%AE%E9%8C%84.png" /></a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../docker_commands/" class="btn btn-neutral float-left" title="Dockerå¸¸ç”¨å‘½ä»¤"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../%E9%81%8B%E7%B6%AD%E7%9F%A5%E8%AD%98/" class="btn btn-neutral float-right" title="é‹ç¶­çŸ¥è­˜">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../docker_commands/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../%E9%81%8B%E7%B6%AD%E7%9F%A5%E8%AD%98/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
